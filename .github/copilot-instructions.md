# GitHub Copilot Instructions for YeaBuddyBot

This is a TypeScript-based Telegram bot for fitness and workout tracking, using Telegraf for bot interactions and Mistral AI for natural language processing. Please follow these guidelines when contributing:

## Code Standards

### Required Before Each Commit
- Run `npm run build` to ensure TypeScript compilation is successful
- Verify all TypeScript strict mode requirements are met
- Test bot functionality with `npm run dev` before committing

### Development Flow
- **Build**: `npm run build` (compiles TypeScript to dist/)
- **Development**: `npm run dev` (runs with hot reload using tsx)
- **Production**: `npm run start:prod` (builds and runs compiled JavaScript)
- **Start compiled**: `npm start` (runs pre-compiled JavaScript from dist/)

## Repository Structure
- `src/`: Main TypeScript source code
  - `index.ts`: Application entry point
  - `config.ts`: Configuration and environment variables
  - `mistral.ts`: Mistral AI integration for message handling
  - `bot/`: Core bot logic and handlers
    - `YeaBuddyBot.ts`: Main bot class with Telegraf setup
    - `scenes/`: Telegraf scene definitions for complex user interactions
      - `WorkoutScenes.ts`: Workout-related conversation flows
    - `training/`: Training session management
      - `TrainingSession.ts`: Training session logic and state management
- `dist/`: Compiled JavaScript output (generated by TypeScript)
- `.github/`: GitHub configuration and workflows
- `package.json`: Dependencies and npm scripts
- `tsconfig.json`: TypeScript configuration with strict mode enabled

## Key Technologies
- **TypeScript**: Strict mode enabled with modern ES2022 target
- **Telegraf**: Telegram bot framework with scene support
- **Express**: Web server for webhook handling and health checks
- **Mistral AI**: Natural language processing for bot interactions
- **Node.js**: ES modules with modern import/export syntax

## Key Guidelines

1. **TypeScript Best Practices**
   - Follow strict TypeScript configuration (no any types, proper null checks)
   - Use proper interface definitions for bot contexts and data structures
   - Maintain type safety throughout the codebase
   - Use modern ES2022+ features and syntax

2. **Bot Development Patterns**
   - Supports both webhook and polling modes based on environment configuration
   - Use Telegraf scenes for complex multi-step user interactions
   - Implement proper session management for user state
   - Handle errors gracefully with user-friendly messages
   - Follow Telegram Bot API best practices for message formatting
   - Webhook mode provides `/health` endpoint for monitoring

3. **Code Organization**
   - Keep bot handlers in the `bot/` directory
   - Use scene-based architecture for complex workflows
   - Separate business logic from bot-specific code
   - Maintain clear separation between AI processing and bot logic

4. **AI Integration**
   - Use Mistral AI for natural language understanding
   - Handle AI responses appropriately within Telegram's message limits
   - Implement fallback responses for AI service failures
   - Consider rate limiting and API usage optimization

5. **Environment and Configuration**
   - Use environment variables for sensitive data (bot tokens, API keys)
   - Keep configuration centralized in `config.ts`
   - Set `WEBHOOK_URL` environment variable to enable webhook mode
   - Set `PORT` environment variable to specify server port (default: 3000)
   - Never commit sensitive credentials to the repository

6. **Testing and Validation**
   - Test bot interactions manually using `npm run dev`
   - Verify TypeScript compilation with `npm run build`
   - Test error scenarios and edge cases
   - Ensure proper handling of different user input types

7. **Documentation**
   - Document complex bot scenes and workflows
   - Add JSDoc comments for public methods and interfaces
   - Keep README.md updated with setup and usage instructions
   - Document any new environment variables or configuration options

## Fitness/Workout Domain Guidelines
- Focus on user-friendly workout tracking and fitness guidance
- Implement intuitive conversation flows for workout logging
- Consider different fitness levels and user preferences
- Provide helpful and motivating responses aligned with fitness goals
- Ensure workout data persistence and proper session management

## Common Patterns to Follow
- Use async/await for all asynchronous operations
- Implement proper error boundaries for bot handlers
- Use TypeScript interfaces for all data structures
- Follow the existing scene-based architecture for new features
- Maintain consistent code formatting and naming conventions

## Deployment Modes

### Polling Mode (Development)
- No webhook URL required
- Bot polls Telegram servers for updates
- Suitable for development and testing
- Uses `npm run dev` for hot reload

### Webhook Mode (Production)
- Requires WEBHOOK_URL environment variable
- Uses Express server to receive webhook updates
- More efficient for production deployments
- Includes health check endpoint at `/health`
- Telegram webhook endpoint at `/webhook`

## Development Environment Setup
- Node.js (version specified in package.json engines field)
- TypeScript compiler (installed as dev dependency)
- Express for webhook handling
- Environment variables configured for bot token and API keys

## Debugging Tips
- Use `npm run dev` for development with hot reload
- Check console output for error messages and logs
- Test bot commands interactively in Telegram
- Validate environment variables are properly configured
- Use `/health` endpoint to verify webhook server is running
- Check webhook delivery in Telegram Bot API debug info
